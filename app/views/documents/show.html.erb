<% meta_title @document.title %>

<% css_assets 'editor' %>
<% js_assets 'editor' %>

<!-- workspace -->

<section class="workspace_wrap site_wrap wrap">
  <div class="editor_wrap wrap" id="editor">
    <%= render "documents/title" %>
    <%= render "documents/webdoc" %>
    <%= render "documents/authors_sidebar" %>
    <%= render "documents/panels/toolbar_panel" %>
    <%= render "documents/panels/controls_panel" %>
    <%= render "documents/inspectors/document_inspector" %>
    <%= render "documents/panels/discussions_panel" %>
    <%= render "documents/panels/my_content_panel" %>
    <%= render "documents/panels/apps_panel" %>
    <%= render "documents/panels/packages_panel" %>
    <%= render "documents/panels/browse_web_panel" %>
    <%= render "documents/inspectors/document_inspector" %>
    <%#= render :partial => "documents/panels/social_panel" %>
    <%= render "documents/inspectors/page_inspector" %>
    <%= render "documents/panels/pages_panel" %>
    <%= render "documents/panels/inspector_panel" %>
  </div>
</section>

<%= render "relatedcontent", :documents => @related_documents %>
<%= render 'shared/popup' %>
<% content_for :scripts do %>
  <script>
    WebDoc.WidgetManager.videoWidget = new WebDoc.Widget(<%= raw Rails.cache.fetch("widget_json_video") { Medias::Widget.first(:conditions => {:system_name => 'video'}).to_json } %>);

    new WebDoc.Document(<%= raw Rails.cache.fetch("document_#{@document.uuid}") { @document.as_application_json.to_json.gsub('/script','/sscript') } %>);

    WebDoc.DocumentCategoriesManager._documentCategories = WebDoc.ServerManager.createRecords(WebDoc.Category,<%= raw Rails.cache.fetch("categories_json") { Category.all.to_json } %>);
    WebDoc.ThemeManager._defaultTheme = new WebDoc.Theme(<%= raw Rails.cache.fetch("default_theme_json") { Theme.default.to_json } %>);
    WebDoc.Application.main(function() {
      //var editor2 = new WebDoc.DocumentEditor();
      //editor2.start();
      
      var editor = new WebDoc.PageEditor();
      editor.load("<%= @document.uuid %>", <%= edit_mode? %>);
    });
  </script>
<% end %>

